# é¡¹ç›®å¼€å‘è§„åˆ™çº¦å®š

## é¡¹ç›®åŸºæœ¬ä¿¡æ¯

### é¡¹ç›®åç§°

- NPM åŒ…åï¼š`bumpster`ï¼ˆåŸå @ai-app-base/bump-version-jsï¼‰
- é¡¹ç›®æè¿°ï¼šä¸€ä¸ªæ™ºèƒ½çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†å‘½ä»¤è¡Œå·¥å…·
- GitHub ä»“åº“ï¼š`git@github.com:yarnovo/bumpster-js.git`

### å‘½ä»¤è¡Œå·¥å…·

- ä¸»å‘½ä»¤ï¼š`bump`
- åˆ«åå‘½ä»¤ï¼š`bump-js`
- äºŒè¿›åˆ¶æ–‡ä»¶ï¼š`./dist/bump-version.js`

### å‘½ä»¤è¡Œé€‰é¡¹

- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `-v, --version` - æ˜¾ç¤ºç‰ˆæœ¬å·
- `--dry-run` - é¢„è§ˆæ“ä½œä½†ä¸å®é™…æ‰§è¡Œï¼ˆæ— å‰¯ä½œç”¨ï¼‰

### å­å‘½ä»¤

- `validate <version>` - éªŒè¯ç‰ˆæœ¬å·æ˜¯å¦ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯

- TypeScript - ä¸»è¦å¼€å‘è¯­è¨€
- Node.js - è¿è¡Œç¯å¢ƒ
- ES Modules - æ¨¡å—ç³»ç»Ÿ

### ä¸»è¦ä¾èµ–

- semver - è¯­ä¹‰åŒ–ç‰ˆæœ¬è§£æå’Œè®¡ç®—
- prompts - å‘½ä»¤è¡Œäº¤äº’ç•Œé¢
- chalk - ç»ˆç«¯é¢œè‰²è¾“å‡º

### å¼€å‘å·¥å…·

- Vitest - æµ‹è¯•æ¡†æ¶
- ESLint - ä»£ç è§„èŒƒæ£€æŸ¥
- Prettier - ä»£ç æ ¼å¼åŒ–
- eslint-config-prettier - ç¦ç”¨ä¸ Prettier å†²çªçš„ ESLint è§„åˆ™
- eslint-plugin-prettier - å°† Prettier ä½œä¸º ESLint è§„åˆ™è¿è¡Œ
- Husky - Git hooks
- lint-staged - æš‚å­˜æ–‡ä»¶æ£€æŸ¥

## é¡¹ç›®ç»“æ„

```
bumpster/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ bump-version.ts    # ä¸»ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ dist/                  # æ„å»ºè¾“å‡º
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
```

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

- ä½¿ç”¨ ESLint è¿›è¡Œä»£ç æ£€æŸ¥
- ä½¿ç”¨ Prettier è¿›è¡Œä»£ç æ ¼å¼åŒ–
- Git æäº¤å‰è‡ªåŠ¨è¿è¡Œ lint-staged

### æµ‹è¯•è¦æ±‚

- è¿è¡Œæµ‹è¯•ï¼š`npm test`
- è¿è¡Œ lintï¼š`npm run lint`
- è¿è¡Œç±»å‹æ£€æŸ¥ï¼š`npm run typecheck`

## æ–‡æ¡£ç»´æŠ¤è§„åˆ™

### æ–‡æ¡£æ›´æ–°è¦æ±‚

æ¯æ¬¡æ›´æ–°ä»£ç æˆ–æ–‡ä»¶åï¼Œå¿…é¡»æ£€æŸ¥å¹¶æ›´æ–°ç›¸å…³æ–‡æ¡£ï¼š

- **README.md** - ç”¨æˆ·æ–‡æ¡£ï¼ŒåŒ…å«ä½¿ç”¨è¯´æ˜ã€API å‚è€ƒç­‰
- **DEVELOPMENT.md** - å¼€å‘æ–‡æ¡£ï¼ŒåŒ…å«å¼€å‘ç¯å¢ƒè®¾ç½®ã€é¡¹ç›®ç»“æ„ç­‰
- **DEPLOYMENT.md** - éƒ¨ç½²æ–‡æ¡£ï¼ŒåŒ…å« GitHub Actions é…ç½®å’Œéƒ¨ç½²æµç¨‹
- **TESTING.md** - æµ‹è¯•æ–‡æ¡£ï¼ŒåŒ…å«æœ¬åœ°æµ‹è¯•ã€npm link å’Œå…¨å±€å®‰è£…æµç¨‹

### é¡¹ç›®æ–‡æ¡£ç»“æ„

- **ç”¨æˆ·å‘æ–‡æ¡£**ï¼šREADME.mdï¼ˆä½¿ç”¨è¯´æ˜ï¼‰
- **å¼€å‘è€…æ–‡æ¡£**ï¼šDEVELOPMENT.mdï¼ˆå¼€å‘æŒ‡å—ï¼‰ã€TESTING.mdï¼ˆæµ‹è¯•æŒ‡å—ï¼‰
- **è¿ç»´æ–‡æ¡£**ï¼šDEPLOYMENT.mdï¼ˆéƒ¨ç½²é…ç½®ï¼‰

### æ›´æ–°åŸåˆ™

- ä»£ç å˜æ›´åç«‹å³æ›´æ–°ç›¸å…³æ–‡æ¡£
- ä¿æŒæ–‡æ¡£ä¸ä»£ç çš„ä¸€è‡´æ€§
- ä½¿ç”¨æ¸…æ™°çš„ä¸­æ–‡æè¿°
- æä¾›å®Œæ•´çš„ç¤ºä¾‹ä»£ç 

## è°ƒè¯•æŠ€å·§

### ESLint comma-dangle é”™è¯¯

å¦‚æœé‡åˆ° comma-dangle é”™è¯¯ï¼Œè¿è¡Œ `npm run lint:fix` è‡ªåŠ¨ä¿®å¤ã€‚

### TypeScript ç¼–è¯‘å™¨æŸåé—®é¢˜

å¦‚æœé‡åˆ° TypeScript ç¼–è¯‘å™¨é”™è¯¯ï¼ˆå¦‚ `Invalid or unexpected token`ï¼‰ï¼Œè¯´æ˜ node_modules ä¸­çš„ TypeScript æ–‡ä»¶å¯èƒ½å·²æŸåã€‚è§£å†³æ–¹æ³•ï¼š

1. åˆ é™¤ node_modules å’Œ package-lock.jsonï¼š`rm -rf node_modules package-lock.json`
2. é‡æ–°å®‰è£…ä¾èµ–ï¼š`npm install`
3. éªŒè¯ä¿®å¤ï¼š`npm run build`

### ESLint å’Œ Prettier å…¼å®¹æ€§é…ç½®

é¡¹ç›®ä½¿ç”¨ ESLint è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼ŒPrettier è¿›è¡Œä»£ç æ ¼å¼åŒ–ã€‚ä¸ºé¿å…è§„åˆ™å†²çªï¼š

1. å·²å®‰è£… `eslint-config-prettier` å’Œ `eslint-plugin-prettier`
2. ESLint é…ç½®ä¸­é›†æˆäº† Prettier æ’ä»¶
3. æ ¼å¼åŒ–è§„åˆ™ï¼ˆå¦‚ `semi`ã€`quotes`ã€`comma-dangle`ï¼‰ç”± Prettier ç»Ÿä¸€å¤„ç†
4. è¿è¡Œ `npm run format` æ ¼å¼åŒ–ä»£ç ï¼Œ`npm run lint` æ£€æŸ¥ä»£ç è´¨é‡

é…ç½®è¦ç‚¹ï¼š

- `.prettierrc.json` å®šä¹‰æ ¼å¼åŒ–è§„åˆ™
- `eslint.config.js` ä¸­ä½¿ç”¨ `prettier/prettier` è§„åˆ™
- é€šè¿‡ `prettierConfig.rules` ç¦ç”¨å†²çªçš„ ESLint è§„åˆ™

### lint-staged é…ç½®ä¼˜åŒ–

ä¸ºé¿å…é‡å¤æ ¼å¼åŒ–ï¼Œ`lint-staged` é…ç½®å·²ä¼˜åŒ–ï¼š

- **TypeScript æ–‡ä»¶** (`*.{ts,tsx}`)ï¼šåªè¿è¡Œ `eslint --fix`
  - ESLint é€šè¿‡ `prettier/prettier` è§„åˆ™è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
  - ä¸éœ€è¦å•ç‹¬è¿è¡Œ `prettier --write`
- **å…¶ä»–æ–‡ä»¶** (`*.{json,md}`)ï¼šè¿è¡Œ `prettier --write`
  - è¿™äº›æ–‡ä»¶ ESLint ä¸å¤„ç†ï¼Œéœ€è¦ç›´æ¥ç”¨ Prettier

è¿™æ ·å¯ä»¥æé«˜ Git æäº¤æ•ˆç‡ï¼Œé¿å…é‡å¤æ ¼å¼åŒ–æ“ä½œã€‚

## CI/CD é…ç½®

### GitHub Actions æƒé™é…ç½®

é¡¹ç›®ä½¿ç”¨ GitHub Actions è¿›è¡ŒæŒç»­é›†æˆå’Œéƒ¨ç½²ã€‚å…³é”®é…ç½®ï¼š

1. **æƒé™å£°æ˜**ï¼ˆå¿…é¡»ï¼‰ï¼š

   ```yaml
   permissions:
     contents: write # å…è®¸åˆ›å»º release
     packages: write # å…è®¸å‘å¸ƒåŒ…
   ```

2. **Release åˆ›å»º**ï¼š
   - ä½¿ç”¨ `softprops/action-gh-release@v1` æ›¿ä»£è¿‡æ—¶çš„ `actions/create-release@v1`
   - é¿å… "Resource not accessible by integration" é”™è¯¯

3. **NPM å‘å¸ƒé…ç½®**ï¼š
   - éœ€è¦åœ¨ä»“åº“è®¾ç½®ä¸­é…ç½® `NPM_TOKEN` secret
   - åŒ…åå·²æ›´æ–°ä¸º `bumpster`

## åŠŸèƒ½ç‰¹æ€§

### Dry-Run æ¨¡å¼

æ”¯æŒ `--dry-run` å‚æ•°ï¼Œç”¨äºé¢„è§ˆæ“ä½œè€Œä¸å®é™…æ‰§è¡Œï¼š

- **ä½¿ç”¨æ–¹æ³•**ï¼š`bump --dry-run`
- **åŠŸèƒ½ç‰¹ç‚¹**ï¼š
  - æ˜¾ç¤º "ğŸ§ª DRY-RUN æ¨¡å¼" æç¤º
  - é¢„è§ˆæ‰€æœ‰ Git æ“ä½œï¼ˆcommitã€tagã€pushï¼‰ä½†ä¸æ‰§è¡Œ
  - é¢„è§ˆæ–‡ä»¶æ›´æ–°ï¼ˆpackage.jsonã€package-lock.jsonï¼‰ä½†ä¸å†™å…¥
  - æ¯ä¸ªæ“ä½œéƒ½ä¼šæ˜¾ç¤º "[DRY-RUN] å°†æ‰§è¡Œ: xxx"
- **å®ç°æ–¹å¼**ï¼š
  - å…¨å±€å˜é‡ `isDryRun` æ§åˆ¶æ¨¡å¼
  - åœ¨ `exec` å‡½æ•°ä¸­æ‹¦æˆª Git å‘½ä»¤
  - åœ¨æ–‡ä»¶å†™å…¥å‰è¿›è¡Œåˆ¤æ–­

<!-- æœ€åæ›´æ–°æ—¶é—´: 2025-01-08T14:22:54+08:00 -->
<!-- æœ€åæ£€æŸ¥æ—¶é—´: 2025-01-08T14:22:54+08:00 -->
